<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-03-15 Fri 16:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Copy and Move</title>
<meta name="author" content="NzSN" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Copy and Move</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge04f709">1. Semantics of Transfer Values</a></li>
<li><a href="#orgc51742e">2. Syntax of Copy and Move</a></li>
<li><a href="#orgd13b82d">3. About Copy</a>
<ul>
<li><a href="#org3471d46">3.1. Implicit-Declared Copy Constructor/Operator</a></li>
<li><a href="#orgcab3312">3.2. Copy Bases</a></li>
</ul>
</li>
<li><a href="#org85ed07c">4. About Move</a></li>
</ul>
</div>
</div>
<div id="outline-container-orge04f709" class="outline-2">
<h2 id="orge04f709"><span class="section-number-2">1.</span> Semantics of Transfer Values</h2>
<div class="outline-text-2" id="text-1">
<p>
Mechanisms to support semantic &rsquo;Value Transfer (x=y)&rsquo; are:
</p>

<ul class="org-ul">
<li>Copy: To transfer value from one to another by make a duplicate of given value</li>
<li>Move: To transfer value from one to another by transfer the ownership of physical part of value.</li>
</ul>

<p>
&rsquo;Value Transfer&rsquo; is the commonality of those two mechanisms. There are differences between them, Copy do not affect the entity that copy from but Move do, Move will let the copy from entity in to <i><b>Move-From Stated</b></i>, this state only guarantee correctly of copy (copy-from, copy-to) and destruction.
</p>

<p>
There are another subtle properties that a copy operation should obey:
</p>

<ul class="org-ul">
<li>Equivalence: x&rsquo;s value must be equal to y&rsquo; after &rsquo;x=y&rsquo;.</li>
<li>Indenpendence: Change on each of x and y should not change another after &rsquo;x=y&rsquo;.</li>
</ul>
</div>
</div>
<div id="outline-container-orgc51742e" class="outline-2">
<h2 id="orgc51742e"><span class="section-number-2">2.</span> Syntax of Copy and Move</h2>
<div class="outline-text-2" id="text-2">
<p>
Our next question is where or how can we make use of <i><b>Copy</b></i> or <i><b>Move</b></i> for a specific entity. This is a question about how is a syntax of <i><b>Copy</b></i> and <i><b>Move</b></i>.
</p>

<p>
<i><b>Copy</b></i> or <i><b>Move</b></i> may happens in assignment or construction. Assignment is done by <i><b>Copy operator</b></i> and Copy/Move Construction is done by Copy/Move Construction.
</p>

<p>
For example,
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #b9c791;">T</span> <span style="color: #47ba99;">y</span> <span style="color: #4EB8CA;">{}</span>;
<span style="color: #b9c791;">T</span> <span style="color: #47ba99;">x</span> = y; <span style="color: #697375;">// </span><span style="color: #697375;">Copy y to x</span>

<span style="color: #b9c791;">T</span> <span style="color: #47ba99;">z</span> = <span style="color: #4FA8A3;">std</span>::move<span style="color: #4EB8CA;">(</span>y<span style="color: #4EB8CA;">)</span>; <span style="color: #697375;">// </span><span style="color: #697375;">Move y to x, More meaningful name of std::move is std::rval</span>
</pre>
</div>

<p>
Compiler make decision to use copy or move by type of argument, use copy if type of argument is lvalue reference or move if type of argument is rvalue reference. std::move(y) will return an rvalue reference of y.
</p>

<p>
Type signature of methods to implement Copy and Move are:
</p>

<p>
Copy methods
</p>
<ul class="org-ul">
<li>T(const T&amp;)</li>
<li>T&amp; operator=(const T&amp;)</li>
</ul>

<p>
Move methods
</p>
<ul class="org-ul">
<li>T(T&amp;&amp;)</li>
<li>T&amp; operator(T&amp;&amp;)</li>
</ul>
</div>
</div>
<div id="outline-container-orgd13b82d" class="outline-2">
<h2 id="orgd13b82d"><span class="section-number-2">3.</span> About Copy</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org3471d46" class="outline-3">
<h3 id="org3471d46"><span class="section-number-3">3.1.</span> Implicit-Declared Copy Constructor/Operator</h3>
<div class="outline-text-3" id="text-3-1">
<p>
For convenience, Compiler will synthesize a <i><b>Copy Constructor</b></i> for class if some rules are satisfied. Those Implicit-Decalred Copys only do <i><b>Memberwise Copy</b></i> to objects. In some cases, <i><b>Memberwise Copy</b></i> will cause memory or logic problems, so you should take care of <i><b>Implicit-Declared Copy Constructor/Operator</b></i>. For example, a memboer x of a class type T of pointer type in memberwise copy will create two pointers that point to the same memory address which may incur double free error in future.
</p>
</div>
</div>
<div id="outline-container-orgcab3312" class="outline-3">
<h3 id="orgcab3312"><span class="section-number-3">3.2.</span> Copy Bases</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Slicing happens When you copy objects to it&rsquo;s Base class. Slicing is a phenomenon that only the base object within the derived object is copied to another base object. In another word, you slicing the base part of your object out from derived object.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #4EB8CA;">struct</span> <span style="color: #b9c791;">B</span> <span style="color: #4EB8CA;">{</span>
    <span style="color: #b9c791;">int</span> <span style="color: #47ba99;">b</span>;
<span style="color: #4EB8CA;">}</span>;

<span style="color: #4EB8CA;">struct</span> <span style="color: #b9c791;">D</span>: <span style="color: #4EB8CA;">public</span> <span style="color: #b9c791;">B</span> <span style="color: #4EB8CA;">{</span>
    <span style="color: #b9c791;">int</span> <span style="color: #47ba99;">d</span>;
<span style="color: #4EB8CA;">}</span>;

<span style="color: #b9c791;">int</span> <span style="color: #91b9c7;">main</span><span style="color: #4EB8CA;">()</span> <span style="color: #4EB8CA;">{</span>
    <span style="color: #b9c791;">D</span> <span style="color: #47ba99;">d</span>;
    <span style="color: #b9c791;">B</span> <span style="color: #47ba99;">b</span>;

    b = d;  <span style="color: #697375;">// </span><span style="color: #697375;">Slicing here</span>
    <span style="color: #4EB8CA;">return</span> <span style="color: #ef6787;">0</span>;
<span style="color: #4EB8CA;">}</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org85ed07c" class="outline-2">
<h2 id="org85ed07c"><span class="section-number-2">4.</span> About Move</h2>
<div class="outline-text-2" id="text-4">
<p>
Move is exists to resolve logic and performance problems in some cases that cause by copy. For example, with copy you will make extra copy of the object you want to swap which is error in logic and in another cases copy will cause a big performance impact if you need to copy massive bytes from one memory area to another memory area.
</p>

<p>
Default move will leave the object be copied into <i><b>Move-From State</b></i> which only gurantee that <i><b>Default Destructor</b></i> and <i><b>Default Copy Assignment</b></i> work correctly, stronger gurantees should provide by user.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: NzSN</p>
<p class="date">Created: 2024-03-15 Fri 16:06</p>
</div>
</body>
</html>
