<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-03-15 Fri 16:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pipeline</title>
<meta name="author" content="NzSN" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Pipeline</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org1cba747">1. Terminology</a></li>
<li><a href="#org69c5fbb">2. What is Pipeline ?</a></li>
<li><a href="#orga99d05c">3. Five-Stage Simple RISC Pipeline</a>
<ul>
<li><a href="#org995d64d">3.1. Instruction Fetch Cycle (IF)</a></li>
<li><a href="#orgb47475c">3.2. Instruction Decode/Register fetch Cycle (ID)</a></li>
<li><a href="#org51f5f85">3.3. Execution/Effective Address Cycle (EX)</a></li>
<li><a href="#org1b29079">3.4. Memory Access (MEM)</a></li>
<li><a href="#org91e7a35">3.5. Write-Back Cycle (WB)</a></li>
</ul>
</li>
<li><a href="#org5f9957a">4. Hazards</a>
<ul>
<li><a href="#orgc7e3564">4.1. Structural hazards</a></li>
<li><a href="#org9f76f32">4.2. Data hazards</a>
<ul>
<li><a href="#orged77b8b">4.2.1. RAW</a></li>
</ul>
</li>
<li><a href="#orgf76b042">4.3. Branch hazards</a>
<ul>
<li><a href="#orgbc95f7e">4.3.1. Ways to reducing pipeline branch penalities</a></li>
<li><a href="#org715a18b">4.3.2. Performance Of Branch Schemes</a></li>
<li><a href="#org62560b3">4.3.3. Reducing the Cost of Branches Through Prediction</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org1cba747" class="outline-2">
<h2 id="org1cba747"><span class="section-number-2">1.</span> Terminology</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>IM: Instruction memory</li>
<li>DM: Data memory</li>
</ul>
</div>
</div>
<div id="outline-container-org69c5fbb" class="outline-2">
<h2 id="org69c5fbb"><span class="section-number-2">2.</span> What is Pipeline ?</h2>
<div class="outline-text-2" id="text-2">
<p>
Pipeline is a structure that interprete and execute instructions, it more like an assembly line that build and perfrom instructions. Each instructions moved one step donw the pipeline for each <i><b>Processor Cycle</b></i>, which is almost always 1 clock cycle.
</p>

<p>
Throughtput of a <i><b>Pipeline</b></i> is how often an instruction exit hte pipeline. If the stages are perfectly balanced, then the time per instruction on the <i><b>pipeline</b></i> is equal to:
</p>

<p>
\(\frac{\text{Time per instruction on unpipelined machine}}{\text{Number of pipe stages}}\)
</p>

<p>
Pipeline is a technique that exploit paralleism among the instructions in a sequential instruction stream.
</p>
</div>
</div>
<div id="outline-container-orga99d05c" class="outline-2">
<h2 id="orga99d05c"><span class="section-number-2">3.</span> Five-Stage Simple RISC Pipeline</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org995d64d" class="outline-3">
<h3 id="org995d64d"><span class="section-number-3">3.1.</span> Instruction Fetch Cycle (IF)</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Send the PC to memory and fetch the current instruction from memory.
</p>
</div>
</div>
<div id="outline-container-orgb47475c" class="outline-3">
<h3 id="orgb47475c"><span class="section-number-3">3.2.</span> Instruction Decode/Register fetch Cycle (ID)</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Decode the instruction and read the registers corresponding to register source specifiers from the register file.
</p>
</div>
</div>
<div id="outline-container-org51f5f85" class="outline-3">
<h3 id="org51f5f85"><span class="section-number-3">3.3.</span> Execution/Effective Address Cycle (EX)</h3>
<div class="outline-text-3" id="text-3-3">
<p>
ALU perfrom operands prepared in the prior cycle, performing one of three functions:
</p>

<ol class="org-ol">
<li>Memory reference</li>
<li>Register-Register ALU instruction</li>
<li>Register-Immediate ALU instruction</li>
<li>COND Branch</li>
</ol>
</div>
</div>
<div id="outline-container-org1b29079" class="outline-3">
<h3 id="org1b29079"><span class="section-number-3">3.4.</span> Memory Access (MEM)</h3>
<div class="outline-text-3" id="text-3-4">
<p>
If instruction is a load, the memory does a read from effective address computed in the previous cycle.
</p>

<p>
If it&rsquo;s a store, the memory write datas from register using the effective address.
</p>
</div>
</div>
<div id="outline-container-org91e7a35" class="outline-3">
<h3 id="org91e7a35"><span class="section-number-3">3.5.</span> Write-Back Cycle (WB)</h3>
<div class="outline-text-3" id="text-3-5">
<ul class="org-ul">
<li>Register-Register ALU instruction or load instruction.</li>
</ul>

<p>
Write back value to register file, whether it comes from memory or from ALU.
</p>
</div>
</div>
</div>
<div id="outline-container-org5f9957a" class="outline-2">
<h2 id="org5f9957a"><span class="section-number-2">4.</span> Hazards</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgc7e3564" class="outline-3">
<h3 id="orgc7e3564"><span class="section-number-3">4.1.</span> Structural hazards</h3>
</div>

<div id="outline-container-org9f76f32" class="outline-3">
<h3 id="org9f76f32"><span class="section-number-3">4.2.</span> Data hazards</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Types of data hazards:
</p>

<ul class="org-ul">
<li>Read After Write (RAW):</li>
<li>Write After Read (WAR):</li>
<li>Write After Write (WAW):</li>
</ul>
</div>
<div id="outline-container-orged77b8b" class="outline-4">
<h4 id="orged77b8b"><span class="section-number-4">4.2.1.</span> RAW</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
Two instruction, one for read and one for write, access the same register and the read one is after the write one.
</p>

<p>
For example:
</p>

<pre class="example" id="org4e3dba0">
add x1,x2,x3
sub x4,x1,x5
and x6,x1,x7
or  x8,x1,x9
xor x10,x1,x11
</pre>

<p>
Pipeline Status:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Instruction</td>
<td class="org-left">CC1</td>
<td class="org-left">CC2</td>
<td class="org-left">CC3</td>
<td class="org-left">CC4</td>
<td class="org-left">CC5</td>
<td class="org-left">CC6</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DADD R1,R2,R3</td>
<td class="org-left">IM</td>
<td class="org-left">REG</td>
<td class="org-left">ALU</td>
<td class="org-left">DM</td>
<td class="org-left">REG</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DSUB R4,R1,R5</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">IM</td>
<td class="org-left">REG</td>
<td class="org-left">ALU</td>
<td class="org-left">DM</td>
<td class="org-left">REG</td>
</tr>

<tr>
<td class="org-left">AND  R6,R1,R7</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">IM</td>
<td class="org-left">REG</td>
<td class="org-left">ALU</td>
<td class="org-left">DM</td>
</tr>

<tr>
<td class="org-left">OR   R8,R1,R9</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">IM</td>
<td class="org-left">REG</td>
<td class="org-left">ALU</td>
</tr>

<tr>
<td class="org-left">XOR  R10,R1,R11</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">IM</td>
<td class="org-left">REG</td>
</tr>
</tbody>
</table>
</div>
<ol class="org-ol">
<li><a id="orga674a40"></a>Technique to elimiate the stalls for RAW<br />
<div class="outline-text-5" id="text-4-2-1-1">
<p>
Forwarding (also called bypassing or short-circuiting), push result of an instruction to subsequent data dependented instructions once reulst is produce.
</p>

<p>
For example, sub require R1&rsquo;s value at CC4 and R1&rsquo;s value is produced at CC3 then able to use result of ALU at CC3 as input of ALU at CC4 to prevent stall of data hazard.
</p>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgf76b042" class="outline-3">
<h3 id="orgf76b042"><span class="section-number-3">4.3.</span> Branch hazards</h3>
<div class="outline-text-3" id="text-4-3">
<p>
While processor process a branch instruction it does not know which branch to take until the predicate is evaluated. Which means the instruction on pipeline follow the branch instruction may not the instruction that would be taken. Thus another <b>IF</b> may required, which cause performance loss.
</p>
</div>
<div id="outline-container-orgbc95f7e" class="outline-4">
<h4 id="orgbc95f7e"><span class="section-number-4">4.3.1.</span> Ways to reducing pipeline branch penalities</h4>
<div class="outline-text-4" id="text-4-3-1">
<ol class="org-ol">
<li>Freeze or flush the pipeline</li>
<li>Predicated-untaken</li>
<li>Predicated-taken</li>
<li>delayed branch</li>
</ol>

<p>
Freeze is to stall the pipeline until we know the address of the taken branch. Flush is to clean all instruction below the branch instruction
once we know which branch to fetch. Advantages of these scheme is simplicity but it&rsquo;s has greater performance loss in deep stage pipeline.
</p>

<p>
Predicated-untaken ignore the effect of branch instruction until branch predicate is evaluated, if not to take the branch then no penality otherwise let instruction below
the branch instruction idel and fetch target branch instruction. Predicated-taken is treat every branch is taken.
</p>

<p>
Delayed branch &#x2026;
</p>
</div>
</div>
<div id="outline-container-org715a18b" class="outline-4">
<h4 id="org715a18b"><span class="section-number-4">4.3.2.</span> Performance Of Branch Schemes</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
\(\text{Pipeline speedup} = \frac{\text{Pipeline depth}}{\text{1 + Pipeline stall cycles from branchs}}\)
</p>

<p>
\(\text{Pipeline stall cycles from branchs} = \text{Branch freq} \times \text{Branch penalty}\)
</p>

<p>
so we have  \(\text{Pipeline speedup} = \frac{\text{Pipeline depth}}{\text{1 + Branch freq} \times \text{Branc penalty}}\)
</p>
</div>
</div>
<div id="outline-container-org62560b3" class="outline-4">
<h4 id="org62560b3"><span class="section-number-4">4.3.3.</span> Reducing the Cost of Branches Through Prediction</h4>
<div class="outline-text-4" id="text-4-3-3">
</div>
<ol class="org-ol">
<li><a id="org4e148df"></a>Static Branch Prediction<br /></li>

<li><a id="org7328acb"></a>Dynamic Branch Prediction and Branc-Prediction Buffers<br /></li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: NzSN</p>
<p class="date">Created: 2024-03-15 Fri 16:06</p>
</div>
</body>
</html>
